containers:
- name: refresh
  image: public.ecr.aws/aws-cli/aws-cli:2.15.0
  env:
  - name: AWS_REGION
    value: ap-south-1
  command:
  - /bin/sh
  - -c
  - |
    curl -LO https://dl.k8s.io/release/v1.29.0/bin/linux/amd64/kubectl
    chmod +x kubectl
    mv kubectl /usr/local/bin/kubectl

    aws ecr get-login-password --region ap-south-1 | \
    kubectl create secret docker-registry ecr-registry-secret \
      --docker-server=908692150527.dkr.ecr.ap-south-1.amazonaws.com \
      --docker-username=AWS \
      --docker-password-stdin \
      --namespace apps \
      --dry-run=client -o yaml | kubectl apply -f -
